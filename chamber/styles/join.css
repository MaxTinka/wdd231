document.addEventListener('DOMContentLoaded', function() {
  // Set current year and last modified date
  document.getElementById('current-year').textContent = new Date().getFullYear();
  document.getElementById('lastModified').textContent = document.lastModified;
  
  // Set form timestamp
  const now = new Date();
  document.getElementById('timestamp').value = now.toISOString();
  
  // Mobile menu toggle
  const menuButton = document.getElementById('menu-button');
  const primaryNav = document.getElementById('primary-nav');
  
  menuButton.addEventListener('click', function() {
    const isExpanded = this.getAttribute('aria-expanded') === 'true';
    this.setAttribute('aria-expanded', !isExpanded);
    primaryNav.classList.toggle('active');
  });
  
  // Form validation
  const form = document.getElementById('joinForm');
  const requiredFields = form.querySelectorAll('[required]');
  
  // Add real-time validation
  requiredFields.forEach(field => {
    field.addEventListener('input', function() {
      validateField(this);
    });
    
    // Validate on blur
    field.addEventListener('blur', function() {
      validateField(this);
    });
  });
  
  // Form submission
  form.addEventListener('submit', function(e) {
    let isValid = true;
    
    // Validate all required fields
    requiredFields.forEach(field => {
      if (!validateField(field)) {
        isValid = false;
      }
    });
    
    if (!isValid) {
      e.preventDefault();
      // Focus on first invalid field
      const firstInvalid = form.querySelector(':invalid');
      if (firstInvalid) {
        firstInvalid.focus();
      }
    }
  });
  
  // Reset form button
  const resetButton = form.querySelector('button[type="reset"]');
  resetButton.addEventListener('click', function() {
    // Clear error messages
    form.querySelectorAll('.error-message').forEach(el => {
      el.textContent = '';
    });
    
    // Reset visual validation states
    form.querySelectorAll('input, textarea').forEach(field => {
      field.classList.remove('invalid');
    });
  });
  
  // Helper function to validate a field
  function validateField(field) {
    const errorElement = field.closest('.form-field').querySelector('.error-message');
    
    if (field.validity.valid) {
      errorElement.textContent = '';
      field.classList.remove('invalid');
      return true;
    } else {
      showError(field, errorElement);
      field.classList.add('invalid');
      return false;
    }
  }
  
  // Helper function to show appropriate error message
  function showError(field, errorElement) {
    if (field.validity.valueMissing) {
      errorElement.textContent = 'This field is required';
    } else if (field.validity.typeMismatch) {
      errorElement.textContent = 'Please enter a valid ' + field.type;
    } else if (field.validity.patternMismatch) {
      if (field.name === 'title') {
        errorElement.textContent = 'Minimum 7 letters, spaces, or hyphens';
      } else if (field.name === 'phone') {
        errorElement.textContent = 'Please enter a valid phone number';
      }
    } else if (field.validity.tooShort) {
      errorElement.textContent = `Minimum length is ${field.minLength} characters`;
    }
  }
  
  // Enhance membership card selection
  const membershipOptions = document.querySelectorAll('.membership-option');
  
  membershipOptions.forEach(option => {
    option.addEventListener('click', function() {
      // Update aria attributes for accessibility
      membershipOptions.forEach(opt => {
        opt.setAttribute('aria-checked', 'false');
      });
      this.setAttribute('aria-checked', 'true');
    });
    
    // Keyboard navigation
    option.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        this.click();
      }
    });
  });
});
